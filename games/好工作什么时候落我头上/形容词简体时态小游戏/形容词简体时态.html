<!DOCTYPE html>
<html lang="ja">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-93SBX04BC7"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-93SBX04BC7');
    </script>
    <meta charset="UTF-8">
    <title>æ—¥æœ¬èªå½¢å®¹è©ãƒãƒ£ãƒ¬ãƒ³ã‚¸ï¼</title>
    <link href="https://fonts.googleapis.com/css2?family=Yomogi&family=Hachi+Maru+Pop&display=swap" rel="stylesheet">
    <style>
        body {
            background-color: #fff3e6;
            font-family: 'Yomogi', 'Hachi Maru Pop', cursive;
            text-align: center;
            padding: 20px;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background-color: #fff9f0;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 0 15px #ffd699;
        }
        h1 {
            color: #ff9933;
            text-shadow: 2px 2px #ffd699;
            font-family: 'Hachi Maru Pop', cursive;
        }
        .player-box {
            background: #fff;
            padding: 15px;
            border-radius: 10px;
            border: 3px solid #ffcc99;
            width: 250px;
            margin: 20px auto;
            font-size: 1.2em;
        }
        button {
            background-color: #ffcc99;
            border: none;
            padding: 12px 24px;
            border-radius: 20px;
            margin: 8px;
            cursor: pointer;
            transition: 0.3s;
            font-family: 'Hachi Maru Pop', cursive;
        }
        button:hover {
            background-color: #ff9933;
            transform: scale(1.1);
        }
        #question-box {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin: 20px;
            border: 3px solid #ffcc99;
        }
        .option-btn {
            width: 45%;
            margin: 5px;
            font-size: 18px;
            font-family: 'Yomogi', cursive;
        }
        .option-row {
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #timer {
            font-size: 26px;
            color: #ff6666;
            margin: 15px;
            font-family: 'Hachi Maru Pop', cursive;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¾æ—¥æœ¬èªå½¢å®¹è©ãƒãƒˆãƒ«ï¼</h1>
        
        <div>
            <button onclick="document.getElementById('adj-file').click()">ğŸ“ å½¢å®¹è©ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
            <button onclick="document.getElementById('student-file').click()">ğŸ‘¤ å­¦ç”Ÿãƒªã‚¹ãƒˆ</button>
            <button onclick="randomStudent()">ğŸ² ãƒ©ãƒ³ãƒ€ãƒ é¸æŠ</button>
            <button onclick="startGame()">ğŸ® ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
        </div>

        <div class="player-box" id="player">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼</div>
        <div id="timer">æ®‹ã‚Šæ™‚é–“ï¼š60ç§’ â³</div>

        <div id="question-box" style="display:none;">
            <h2 id="question-text"></h2>
            <div id="options-container"></div>
        </div>

        <input type="file" id="adj-file" hidden accept=".txt,.csv,.xls,.xlsx">
        <input type="file" id="student-file" hidden accept=".txt,.csv,.xls,.xlsx">
    </div>

    <!-- æµ®åŠ¨ä¸‹è½½æŒ‰é’®åŒºåŸŸ -->
    <div style="position:fixed;right:2vw;bottom:2vw;z-index:999;display:flex;flex-direction:column;gap:0.7rem;">
        <a href="å¯¼å…¥å•è¯æµ‹è¯•æ–‡æœ¬.txt" download class="start-button">ä¸‹è½½å•è¯æ–‡æœ¬æ¨¡æ¿</a>
        <a href="å­¦ç”Ÿå§“å.txt" download class="start-button">ä¸‹è½½å­¦ç”Ÿå§“åæ¨¡æ¿</a>
    </div>

    <script>
        let adjectives = [];
        let students = [];
        let currentQuestions = [];
        let currentQuestionIndex = 0;
        let correctCount = 0;
        let wrongAnswers = [];
        let timeLeft = 60;
        let timerId;

        // å½¢å®¹è©æ´»ç”¨ãƒ«ãƒ¼ãƒ«
        const conjugations = {
            'ã‚¤å½¢': {
                'present': 'ã„',
                'past': 'ã‹ã£ãŸ',
                'negative-present': 'ããªã„',
                'negative-past': 'ããªã‹ã£ãŸ'
            },
            'ãƒŠå½¢': {
                'present': 'ã ',
                'past': 'ã ã£ãŸ',
                'negative-present': 'ã§ã¯ãªã„',
                'negative-past': 'ã§ã¯ãªã‹ã£ãŸ'
            }
        };

        // ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿
        document.getElementById('adj-file').addEventListener('change', handleFile('adj'));
        document.getElementById('student-file').addEventListener('change', handleFile('student'));

        function handleFile(type) {
            return function(e) {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = function() {
                    const data = this.result.split('\n').map(line => line.trim());
                    if(type === 'adj') {
                        adjectives = data;
                        alert('å½¢å®¹è©ãƒ•ã‚¡ã‚¤ãƒ«ãŒæ­£å¸¸ã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚Œã¾ã—ãŸï¼');
                    } else {
                        students = data;
                        alert('å­¦ç”Ÿãƒªã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãŒæ­£å¸¸ã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚Œã¾ã—ãŸï¼');
                    }
                }
                reader.readAsText(file);
            }
        }

        function randomStudent() {
            if(students.length === 0) return alert("å­¦ç”Ÿãƒªã‚¹ãƒˆã‚’å…ˆã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ãã ã•ã„ï¼");
            document.getElementById('player').textContent = students[Math.floor(Math.random()*students.length)];
        }

        function startGame() {
            if(adjectives.length === 0) return alert("å½¢å®¹è©ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…ˆã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ãã ã•ã„ï¼");
            if(document.getElementById('player').textContent === "ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼") return alert("ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„ï¼");

            currentQuestions = [];
            const usedAdjectives = [];
            for(let i = 0; i < adjectives.length; i++) {
                let adj;
                do {
                    adj = adjectives[Math.floor(Math.random() * adjectives.length)];
                } while (usedAdjectives.includes(adj));
                usedAdjectives.push(adj);
                currentQuestions.push(generateQuestion(adj));
            }
            
            currentQuestionIndex = 0;
            correctCount = 0;
            wrongAnswers = [];
            timeLeft = 60;
            updateTimer();
            
            document.getElementById('question-box').style.display = 'block';
            showQuestion();
            startTimer();
        }

        function startTimer() {
            timerId = setInterval(() => {
                timeLeft--;
                updateTimer();
                if(timeLeft <= 0) endGame();
            }, 1000);
        }

        function updateTimer() {
            const timerElement = document.getElementById('timer');
            timerElement.innerHTML = `æ®‹ã‚Šæ™‚é–“ï¼š${timeLeft}ç§’ ${timeLeft > 10 ? 'â³' : 'âŒ›'}`;
            timerElement.style.color = timeLeft > 10 ? '#ff6666' : '#ff3333';
        }

        function generateQuestion(adj) {
            let type;
            if (adj.endsWith('ã„') && !['ãã‚Œã„', 'å«Œã„'].includes(adj)) {
                type = 'ã‚¤å½¢';
            } else {
                type = 'ãƒŠå½¢';
            }
            const tenses = ['present', 'past', 'negative-present', 'negative-past'];
            const correctTense = tenses[Math.floor(Math.random() * tenses.length)];

            const stem = type === 'ã‚¤å½¢' ? adj.slice(0, -1) : adj;
            const correctAnswer = stem + conjugations[type][correctTense];

            // èª¤ç­”ç”Ÿæˆ
            let options = [correctAnswer];
            while (options.length < 4) {
                const wrongType = Math.random() > 0.5 ? type : (type === 'ã‚¤å½¢' ? 'ãƒŠå½¢' : 'ã‚¤å½¢');
                const wrongTense = tenses[Math.floor(Math.random() * tenses.length)];
                const wrongStem = wrongType === 'ã‚¤å½¢' ? adj.slice(0, -1) : adj;
                const wrongAnswer = wrongStem + conjugations[wrongType][wrongTense];
                if (!options.includes(wrongAnswer)) options.push(wrongAnswer);
            }

            return {
                question: `ã€Œ${adj}ã€ã®${getTenseJapanese(correctTense)}å½¢ã‚’é¸ã‚“ã§ãã ã•ã„ï¼š`,
                options: options.sort(() => Math.random() - 0.5),
                correct: correctAnswer
            };
        }

        function getTenseJapanese(tense) {
            const map = {
                'present': 'ç¾åœ¨',
                'past': 'éå»',
                'negative-present': 'å¦å®šç¾åœ¨',
                'negative-past': 'å¦å®šéå»'
            };
            return map[tense];
        }

        function showQuestion() {
            const q = currentQuestions[currentQuestionIndex];
            document.getElementById('question-text').textContent = q.question;
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';

            for (let i = 0; i < q.options.length; i += 2) {
                const row = document.createElement('div');
                row.className = 'option-row';

                const btn1 = document.createElement('button');
                btn1.className = 'option-btn';
                btn1.textContent = q.options[i];
                btn1.onclick = () => checkAnswer(q.options[i], q.correct);
                row.appendChild(btn1);

                if (i + 1 < q.options.length) {
                    const btn2 = document.createElement('button');
                    btn2.className = 'option-btn';
                    btn2.textContent = q.options[i + 1];
                    btn2.onclick = () => checkAnswer(q.options[i + 1], q.correct);
                    row.appendChild(btn2);
                }

                optionsContainer.appendChild(row);
            }
        }

        function checkAnswer(selected, correct) {
            clearInterval(timerId);

            if (selected === correct) {
                correctCount++;
            } else {
                wrongAnswers.push({
                    question: currentQuestions[currentQuestionIndex].question,
                    correct: correct,
                    selected: selected
                });
            }

            currentQuestionIndex++;
            if (currentQuestionIndex < currentQuestions.length && timeLeft > 0) {
                startTimer();
                showQuestion();
            } else {
                endGame();
            }
        }

        function endGame() {
            clearInterval(timerId);
            const answered = currentQuestionIndex;
            alert(`ã‚¿ã‚¤ãƒ ã‚¢ãƒƒãƒ—ï¼\næ­£è§£æ•°ï¼š${correctCount}/${answered}`);
            document.getElementById('question-box').style.display = 'none';
            exportWrongAnswers();
        }

        function exportWrongAnswers() {
            const csvContent = "å•é¡Œ,æ­£è§£,é¸æŠè‚¢\n" +
                wrongAnswers.map(e => `${e.question},${e.correct},${e.selected}`).join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'é–“é•ãˆãŸå•é¡Œ.csv';
            a.click();
        }
    </script>
</body>
</html>
    